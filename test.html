<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.43/Tone.js"></script>
		<script src="style.js"></script>
		<style>
			:root{user-select:none;-webkit-user-select:none;}
			body{position:relative;overflow:hidden;margin:0;}
			#bg::before{width:100%;height:64px;content:"";position:absolute;background:linear-gradient(#0008,#0000);}
		</style>
		<style>
			@keyframes bob{0%{transform:scale(1);}100%{transform:scale(.9);}}
			@keyframes p{0%{transform:rotateY(0deg);}100%{transform:rotateY(360deg);}}
			.kb{position:relative;left:50%;transform:translateX(-50%);touch-action:none;display:inline-block;}
			.kb>div>div{position:relative;width:84px;height:84px;margin:0;flex-shrink:0;display:inline-block;vertical-align:top;}
			.kb>div>div::before,.kb>div>div::after{content:"";display:block;position:absolute;top:7px;left:7px;width:70px;height:70px;}
			.kb>div>div::before{background:#8888;border-radius:16px;z-index:0;}
			.kb>div>div::after{animation:bob 1.2s ease-in-out 0s infinite alternate;background-image:url(img/tex.png);background-size:560px auto;z-index:1;}
			.kb>div>div:nth-child(2n  ):not(.c)::after{background-position:-70px 0;}
			.kb>div>div:nth-child(2n-1):not(.c)::after{background-position:-140px 0;}

			.kb>div>div.pushed::before,.kb>div>div.pushed::after{transform:scale(.8);}
			.kb>div>div:not(.pushed)::before,.kb>div>div:not(.pushed)::after{transition:.1s;}
			.kb>div>div.anm::after{animation:p .4s ease-in-out;}
		</style>

		<div id="kb" class="kb">
			<div><div id="_-21" class="c"></div><div id="_-19"></div><div id="_-17"></div><div id="_-16"></div><div id="_-14"></div></div>
			<div><div id="_-12"></div><div id="_-10"></div><div id="_-9"  class="c"></div><div id="_-7" ></div><div id="_-5" ></div></div>
			<div><div id="_-4" ></div><div id="_-2" ></div><div id="_0"  ></div><div id="_2"  ></div><div id="_3"   class="c"></div></div>
		</div>
		<div id="pkb" class="kb" style="display:none;">
			<div><div id="0_0"></div><div id="0_1"></div><div id="0_2"></div><div id="0_3"></div></div>
			<div><div id="1_0"></div><div id="1_1"></div><div id="1_2"></div><div id="1_3"></div></div>
		</div>
		<style>
			#menucb{display:none;}
			#menucb+label{position:fixed;top:0;right:0;width:100vw;height:100vh;display:none;}
			#menucb:checked+label{display:block;}
			#menucb+*+*+label{position:fixed;top:2px;right:2px;width:48px;height:48px;}
			#menucb+*+*+label::before,#mico{content:"";position:absolute;top:0;left:0;width:48px;height:48px;background:url(img/tex.png);background-size:384px auto;transition:.4s;}
			#menucb+*+*+label::before{opacity:0;background-position:-192px 0;}
			#menucb:checked+*+*+label::before{opacity:1;}#menucb:checked+*+*+label>#mico{opacity:0;}
			#menucb+*+div{position:fixed;top:0;right:-236px;width:236px;height:100vh;padding-top:48px;background:#8888;transition:.2s;overflow-y:scroll;}
			#menucb:checked+*+div{right:0;}
			#mico{background-position:0 -48px;}
		</style>
		<input type="checkbox" id="menucb">
		<label for="menucb"></label>
		<div>
			test
		</div>
		<label for="menucb"><div id="mico"></div></label>
		<pre id="log">loading soundsâ€¦</pre>


		<script>
			var kbmode=0,sc=12;
			const keymap = [{
				"KeyR":"_-21","KeyT":"_-19","KeyY":"_-17","KeyU":"_-16","KeyI":"_-14",
				"KeyF":"_-12","KeyG":"_-10","KeyH":"_-9" ,"KeyJ":"_-7" ,"KeyK":"_-5" ,
				"KeyC":"_-4" ,"KeyV":"_-2" ,"KeyB":"_0"  ,"KeyN":"_2"  ,"KeyM":"_3"
			},{
				"KeyR":"0_0","KeyT":"0_1","KeyY":"0_2","KeyU":"0_3",
				"KeyF":"1_0","KeyG":"1_1","KeyH":"1_2","KeyJ":"1_3"
			}];
			const synth = new Tone.Sampler(
				{
					"a2":"a2.mp3",
					"d#3":"ds3.mp3","a3":"a3.mp3",
					"d#4":"ds4.mp3","a4":"a4.mp3",
					"d#5":"ds5.mp3","a5":"a5.mp3",
					"d#6":"ds6.mp3"
				},()=>log.textContent+="\nloaded","audio/instr/musicbox/").toDestination();
			function trigger(id) {
				switch(kbmode){
					case 0:
						synth.triggerAttackRelease(440*Math.pow(2,(parseInt(id.slice(1))+sc)/12));
						break;
					case 1:
						synth.triggerAttackRelease("C5","8n");
						break;
					default:
						console.log("unknown id");
				}
			}


			//animation & misc
			document.querySelectorAll('.kb>div>div').forEach((e)=>{
				e.addEventListener("touchstart",function(){trigger(this.id);},false);
				e.addEventListener("mousedown" ,function(){trigger(this.id);},false);
				e.addEventListener("touchstart",function(){
					this.classList.remove('pushed');void this.offsetWidth;this.classList.add('pushed','anm');
				},false);
				e.addEventListener("mousedown",function(){
					this.classList.remove('pushed');void this.offsetWidth;this.classList.add('pushed','anm');
					setTimeout(()=>this.classList.remove('pushed'),100);
				},false);
				e.addEventListener("touchend",function(e){this.classList.remove('pushed');e.preventDefault();},false);
				e.addEventListener("touchcancel",function(){this.classList.remove('pushed');e.preventDefault();},false);
				e.addEventListener("animationend",function(){this.classList.remove('anm');},false);
			})
			document.addEventListener('keydown',e=>{
				if(keymap[kbmode][e.code])document.getElementById(keymap[kbmode][e.code]).dispatchEvent(new Event('mousedown'));
			},false);
		</script>
	</body>
</html>
