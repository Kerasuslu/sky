<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<title>SkyEringi sky_sequencer</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
</head>
<body>
	<script src="https://tonejs.github.io/build/Tone.js"></script>


	<button onclick="ptoggle()">⏯</button>
	<button onclick="pstop()">⏹</button><br>
	bpm:<input type="number" value="90" id="bpm_" onchange="Tone.Transport.bpm.value=parseFloat(this.value)">
	<pre id="log"></pre>

	<script>
		var seq;
		const mbxli = ()=>{var s={};for(var i=2;i<=5;i++){s["a"+i]="a"+i+".mp3";s["d#"+(i+1)]="ds"+(i+1)+".mp3";}return s;};
		const synth = new Tone.Sampler(mbxli(),()=>{},"https://mcbeeringi.github.io/sky/audio/instr/musicbox/").toDestination();
		const scores =[
			"f3,a3,c4,e4,g4",
			["e4,g4","f3,a3,c4"],
			"e4,g4",
			"f3,a3,c4,e4,g4",

			"e3,b3,d4,e4,g4",
			["d4,e4,b4","e3,b3"],
			"d4,e4,b4",
			"e3,b3,a4,c5",

			"a3,c4",
			["e4,g4","a3,c4"],
			"e4,g4",
			["a3,c4,e4,g4","d4,f4"],

			["c3,g3","c4,e4"],
			["","g3"],
			["","g3"],
			["c4,e4","g3"],

			"f3,a3",
			["c4","f3,a3"],
			["c4,e4","f3,a3"],
			["c4","b3,d4,e4"],

			["e3","b3,d4"],
			["","e3"],
			["","e3"],
			["b3,d4,e4","e3"],

			"e3,a3",
			["c4","c4,a3"],
			["","e3,a3"],
			["c4","e3,a3"],

			"c3,g3",
			["c3","c3,e3"],
			["","e3,g3"],
			["g3,c4","c4,e4"]
		];
		/*[
			"C4",
			["E4", "D4", "E4"],
			"G4,D4",
			["A4,E4", "G4,D4"],
			"E4",
			["C4","","D4"],
			"B3",
			"D4,G3"
		];*/



		/////from button
		function ptoggle(){
			Tone.start();
			if(Tone.Transport.state=='started')Tone.Transport.pause();
			else Tone.Transport.start();
		}
		function pstop(){
			Tone.Transport.stop();
		}

		/////Sequence
		function set(x){
			if(seq)seq.dispose();
			seq = new Tone.Sequence((time,note)=>{
				if(note){
					note=note.split(",");
					synth.triggerAttackRelease(note,"1m",time);
					log.textContent+="\n"+note+"\t\t"+time;
				}
			},x).start(0);
			return seq;
		}
		set(scores);
		Tone.Transport.bpm.value=parseFloat(bpm_.value);
	</script>
</body>
</html>
