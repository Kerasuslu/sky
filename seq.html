<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<title>SkyEringi sky_sequencer</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
</head>
<body>
	<script src="style.js"></script>
	<script src="https://tonejs.github.io/build/Tone.js"></script>


	<button onclick="ptoggle()">⏯</button>
	<button onclick="pstop()">⏹</button><br>
	bpm:<input type="number" value="90" id="bpm_" onchange="Tone.Transport.bpm.value=parseFloat(this.value)"><br>
	scale:<input type="number" value="10" id="sc_" onchange="sc=Number(this.value)">
	<pre id="log">from A3
	time stamp
	</pre>

	<script>
		var seq,sc=Number(sc_.value);
		const url_o=(x)=>JSON.stringify(x).replace(/\"/g,"'").replace(/,/g,'.').replace(/\[/g,'(').replace(/\]/g,')'), url_i=(x)=>JSON.parse(x.replace(/'/g,'"').replace(/\./g,',').replace(/\(/g,'[').replace(/\)/g,']'));
		const mbxli = ()=>{var s={};for(var i=2;i<=5;i++){s[`a${i}`]=`a${i}.mp3`;s[`d#${i+1}`]=`ds${i+1}.mp3`;}return s;};
		const synth = new Tone.Sampler(mbxli(),()=>{},"https://mcbeeringi.github.io/sky/audio/instr/musicbox/").connect(new Tone.Volume(-10).toDestination());
		const scores = [
			'-4,0,3,7,10',
			['7,10','-4,0,3'],
			'7,10',
			'-4,0,3,7,10',

			'-5,2,5,7,10',
			['5,7,14','-5,2'],
			'5,7,14',
			'-5,2,12,15',

			'0,3',
			['7,10','0,3'],
			'7,10',
			['0,3,7,10','5,8'],

			['-9,-2','3,7'],
			['','-2'],
			['','-2'],
			['3,7','-2'],

			'-4,0',
			['3','-4,0'],
			['3,7','-4,0'],
			['3','2,5,7'],

			['-5','2,5'],
			['','-5'],
			['','-5'],
			['2,5,7','-5'],

			'-5,0',
			['3','3,0'],
			['','-5,0'],
			['3','-5,0'],

			'-9,-2',
			['-9','-9,-5'],
			['','-5,-2'],
			['-2,3','3,7']
		];


		/////from button
		function ptoggle(){
			Tone.start();
			if(Tone.Transport.state=='started')Tone.Transport.pause();
			else Tone.Transport.start();
		}
		function pstop(){
			Tone.Transport.stop();
		}

		/////Sequence
		const toHz = (x)=>220*Math.pow(2,(Number(x)+sc)/12);
		function set(x){
			if(seq)seq.dispose();
			seq = new Tone.Sequence((time,note)=>{
				if(note){
					note=note.split(',');
					//synth.triggerAttackRelease(note,'1m',time);
					synth.triggerAttackRelease(note.map(toHz),'1m',time);
					log.textContent=note+'\n\t'+time;
				}
			},x).start(0);
			return seq;
		}
		set(scores);
		Tone.Transport.bpm.value=parseFloat(bpm_.value);
	</script>
</body>
</html>
